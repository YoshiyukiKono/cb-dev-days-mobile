## データモデリング

### 序章

ドキュメントスキーマに飛び込む前に、モバイルアプリをもう一度見てみましょう。前のレッスンでモバイルアプリを実行したとき、ログイン画面に2つの異なるオプションが表示されたことを覚えているかもしれません。


- 同期モード：提供されたユーザー資格情報を使用して、このユーザーはドキュメントをCouchbase Serverと同期し、次に他のユーザーと同期できます。
- ゲスト/非同期モード：このオプションにはユーザーの資格情報は必要ありません。これはローカルのみのモードです。ローカルデータベースで作成されたドキュメントは、同期ゲートウェイに同期されません。


次のレッスンでは、これら2つのモードを切り替えて、さまざまな機能をテストします。データモデルは、これら2つのモード間でわずかに異なることに注意してください。それぞれのデータモデルを確認してみましょう。

### 同期モード
ここで、アプリケーションは（Sync Gatewayを介して）CouchbaseServerと通信します。CouchbaseServerバケットに保存されているドキュメントの種類は次のとおりです。

- airline
- airport
- hotel
- route
- user

ユーザードキュメント（下の図の右側）を除いて、残りのドキュメントは本質的に静的/半静的です。デモアプリでは、

- hotelそしてairport、文書作成済みのCouchbaseのLiteデータベースにバンドルとするとき、アプリが起動ロードされます。チュートリアルの「ビルド済みデータベース」セクションで、ビルド済みデータベースの検索と使用について詳しく説明します。

- airline、airport、hotel、route文書はモバイルアプリに同期されていません。代わりに、Travel SampleWebバックエンドによって公開されているRESTWebサービスAPIを介してアプリによってフェッチされます。


### ゲスト/非同期モード
ゲストモードでは、モバイルアプリは匿名ユーザー用の新しいデータベースを作成します。ブックマークされたホテルのリストをローカルに保存するための空のデータベースです。

実際のアプリケーションでは、Travel Sample Mobileアプリのユーザーは、実際にサインアップしなくても、特定の検索条件を満たす特定の場所にあるホテルを閲覧することに関心があると考えられます。彼らはこれらのホテルをブックマークして、後で旅行の予約に追加することができます。これらのブックマークされたホテルは、他のユーザー、たとえば旅行の予約をしているユーザーと共有することもできます。

ゲストモードでは、CouchbaseLiteデータベースは次のタイプのドキュメントをホストします。

- bookmarkedhotels
- hotel


### ドキュメントタイプ
テーブルとは異なり、Couchbaseでは、すべてのドキュメントが同じ名前空間に保存されます。したがって、通常は追加のプロパティを使用して、各エンティティを区別します。それを「タイプ」と呼びましょう。

### やってみて
- インストール時に使用したのと同じ管理者クレデンシャルを使用して、CouchbaseServerの「管理コンソール」にログインします。
- 左側のメニューから「バケット」オプションを選択します
- 旅行サンプルバケットの下にある[ドキュメント]をクリックします
- ID「hotel_10025」のドキュメントを検索します
- ドキュメントの「type」プロパティが「hotel」であることを確認します

### ドキュメントキー/ ID
Couchbaseのすべてのドキュメントは、ドキュメントの作成時にユーザーが提供する必要のある一意のキーに関連付けられています。キーはドキュメントの一意の識別子であり、任意の形式をとることができます。ただし、ドキュメントの内容に関するコンテキストを提供する値を指定することをお勧めします。たとえば、旅行アプリのデータセットでは、ドキュメントのキー/ IDの形式はです{doc.type}_{alphanumeric_string}。ここで{doc.type}は、ドキュメントの目的のコンテキストを提供し、と組み合わせて{alphanumeric_string}、文字列を一意に識別します。ドキュメントキーは、CouchbaseServer管理コンソールに「ID」として表示されます。キーはドキュメントIDとも呼ばれます。


### やってみて
- インストール時に作成した適切な管理者クレデンシャルを使用して、CouchbaseServerの「管理コンソール」にログインします。
- 左側のメニューから「バケット」オプションを選択します
- 旅行サンプルバケットの下にある[ドキュメント]をクリックします
- ID「airline_137」のドキュメントを検索します
- ドキュメントの「callsign」プロパティが「AIRFRANS」であることを確認します

### ドキュメント_id
Sync Gatewayはドキュメントを処理するときに、関連するメタデータをドキュメントに追加します。メタデータには、ドキュメントIDに対応する「_id」プロパティが含まれています。
Sync Gateway REST APIを介してドキュメントをクエリすると、このプロパティが表示されます。

```
{
    "_id": "airline_137",
    "_rev": "1-b4e60280a1a0e3d46efad7bfd0e2068c",
    "callsign": "AIRFRANS",
    "country": "France",
    "iata": "AF",
    "icao": "AFR",
    "id": 137,
    "name": "Air France",
    "type": "airline"
}
```
Couchbase Liteを使用するモバイルアプリ開発者は、通常、_idプロパティを直接読み書きする必要はありません。
meta().idフィールドにクエリを実行して、ドキュメントIDを取得します。
これについては、クエリレッスンで詳しく学習します。
